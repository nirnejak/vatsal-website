import getMetadata from "@/utils/metadata"
import Image from "next/image"

import CoverImage from "./banner.jpg"
import Transformer from "./transformer.png"
import Attention from "./attention.png"
import MultiHeadAttention from "./multi_head_attention.png"
import WorkAttention from "./attention_work.png"

export const metadata = getMetadata({
  path: "/blogs/understanding-the-transformer-architecture/",
  title: "Understanding the Transformer Architecture",
  description:
    "Get a bird’s eye view of the Transformer architecture! and learn how attention, positional encoding, and encoder-decoder structures work together to revolutionize NLP tasks.",
  image: CoverImage.src,
})

# Understanding the Transformer Architecture

<span className="text-base leading-snug text-neutral-500">
  Get a bird’s eye view of the Transformer architecture! and learn how
  attention, positional encoding, and encoder-decoder structures work together
  to revolutionize NLP tasks.
</span>

<Image src={CoverImage} alt={"Cover"} placeholder="blur" />

The Transformer architecture has revolutionized the field of natural language processing (NLP) since its introduction. Unlike traditional sequence-to-sequence models that rely heavily on recurrent neural networks (RNNs) or convolutional neural networks (CNNs), the Transformer leverages self-attention mechanisms to process input data in parallel, significantly improving computational efficiency and performance.

## Overview of the Transformer Architecture

At its core, the Transformer consists of an **Encoder** and a **Decoder**, both built using stacks of identical layers. Each layer comprises sub-layers that perform specific functions essential for understanding and generating sequences.

<Image src={Transformer} alt={"Transformer"} placeholder="blur" />

### Encoder

The Encoder processes the input sequence and transforms it into a context-rich representation. It consists of:

- **Input Embedding**: Converts input tokens into continuous vectors.
- **Positional Encoding**: Adds positional information to the embeddings to retain the order of the sequence.
- **N Encoder Layers**: Each layer contains:
  - **Multi-Head Self-Attention Mechanism**
  - **Normalization and Residual Connections**
  - **Feed-Forward Neural Network**

### Decoder

The Decoder generates the output sequence by attending to the Encoder's output and previously generated tokens. It consists of:

- **Output Embedding**: Converts output tokens into continuous vectors.
- **Positional Encoding**: Similar to the Encoder's positional encoding.
- **N Decoder Layers**: Each layer contains:
  - **Masked Multi-Head Self-Attention**
  - **Encoder-Decoder Attention Mechanism**
  - **Normalization and Residual Connections**
  - **Feed-Forward Neural Network**
- **Linear Layer & Softmax**: Produces the probability distribution over the target vocabulary.

## Detailed Components

Let's dive bit deeper into the essential components of the Transformer architecture.

### Self-Attention

At the heart of the Transformer is the **attention mechanism**, letting each position in the sequence “look around” at every other position to understand contextual relationships. For example, in the sentence “The animal didn’t cross the street because it was too tired,” the word “it” attends to “animal” to understand the correct reference. You can imagine each word as a tiny detective, gathering clues from all the other words to piece together the full story. By doing so, the model forms a richer understanding of the sequence, ensuring that words like “it” are connected to the right subjects and that subtle nuances in meaning are captured as the sentence unfolds.

<Image src={Attention} alt={"Attention"} placeholder="blur" />

For more details on how these work, check out my dedicated blog on [Self Attention](/blogs/self-attention)

### Multi Head Attention

Multi-Head Attention is essentially multiple self-attention modules operating in parallel. Each one focuses on different aspects or “subspaces” of the input, such as syntactic cues, long-range dependencies, or nuanced linguistic features. By concatenating the results from these different “heads,” the model obtains a more comprehensive representation of the sequence. This approach contributes to the Transformer’s flexibility and its ability to learn intricate patterns without relying on recurrent structures.

<Image src={MultiHeadAttention} alt={"MultiHeadAttention"} placeholder="blur" />

For more details on how these work, check out my dedicated blog on [Self Attention](/blogs/self-attention)

### Encoder-Decoder Attention

Encoder-Decoder Attention, sometimes referred to as cross-attention, helps the Decoder selectively focus on the context generated by the Encoder. In tasks like machine translation, the Decoder looks back at the encoded source sentence to pinpoint the words or tokens most relevant for producing the next token in the target language. This cross-referencing mechanism is crucial for accuracy in sequence-to-sequence tasks, ensuring that each newly generated token aligns well with the source content.

For more details on how these work, check out my dedicated blog on [Encoder - Decoder Attention](/blogs/encoder-decoder-attention-in-the-transformer)

### Padding Mask and Look-Ahead Mask in the Decoder

Padding Mask is employed to ignore padded tokens in sequences that do not match the maximum length. This prevents the model from attending to artificially added placeholders. Look-Ahead Mask is used in the Decoder to ensure the model does not “peek” at future tokens that have not yet been generated, preserving the autoregressive nature of text generation. These masking strategies are crucial to maintaining both the logical flow of generation and the accuracy of attention computations. Combining the Padding Mask and Look-Ahead Mask with the self-attention mechanism is known as **masked multi-head attention**.

<Image src={WorkAttention} alt={"Self Attention"} placeholder="blur" />

For more details on how these work, check out my dedicated blog on [Padding and Look-Ahead Mask in the Transformer Decoder](/blogs/understanding-padding-and-look-ahead-mask-in-the-transformer-decoder)

### Layer Normalization

Layer Normalization is typically used within Transformer layers to stabilize and speed up training. It operates across the feature dimension (as opposed to Batch Normalization, which works across the batch dimension), which is particularly well-suited for models dealing with variable sequence lengths. Layer Normalization ensures that the hidden states remain in a manageable range, allowing deeper models to train efficiently and effectively. This technique is detailed in various research papers, and its adoption within Transformers has helped enable the training of very large and powerful models without suffering from unstable gradients or exploding/vanishing activations.

Curious how it compares to batch normalization? Check out my [Normalization in Deep Learning](/blogs/normalization-in-deep-learning) blog

### Positional Encoding

Positional Encoding injects order information into token embeddings, allowing the Transformer to distinguish between positions in a sequence. The most common method uses sinusoidal functions that assign a unique pattern for each position, which helps the model learn both absolute and relative positions. By providing an explicit sense of order, the Transformer can handle tasks that rely on sequential structure without relying on recurrent or convolutional loops.

For more details on how these work, check out my dedicated blog on [Sinusoidal Positional Encoding](/blogs/sinusoidal-positional-encoding-in-the-transformer)

## Applications and Impact

The Transformer architecture has paved the way for numerous breakthroughs in NLP:

- **BERT (Bidirectional Encoder Representations from Transformers)**: Utilizes the Transformer encoder for pre-training deep bidirectional representations.
- **GPT Series (Generative Pre-trained Transformer)**: Leverages the Transformer decoder for generating human-like text.
- **T5 (Text-to-Text Transfer Transformer)**: Unifies NLP tasks into a text-to-text format, utilizing the full Transformer architecture.

These models have achieved state-of-the-art results in various NLP tasks, showcasing the Transformer’s versatility and effectiveness.

## Conclusion

The Transformer architecture revolutionized the way we process sequences by replacing the need for heavy sequential recurrence with clever attention mechanisms. **Self-Attention**, **Multi-Head Attention**, **Positional Encoding**, **Encoder-Decoder Attention**, and **Layer Normalization** are the key concepts that make it all work. Each plays a unique role in helping the model learn context effectively and efficiently.

## Next Steps

- [A Comprehensive Overview of BERT](/blogs/a-comprehensive-overview-of-bert)
- [From GPT-1 to GPT-3: A New Era in NLP](/blogs/from-gpt-1-to-gpt-3-a-new-era-in-nlp)
- [T5: The Text-to-Text Transfer Transformer](/blogs/t5-the-text-to-text-transfer-transformer)
- [Self-Attention: Queries, Keys, and Values in Action](/blogs/self-attention)
- [Normalization in Deep Learning](/blogs/normalization-in-deep-learning)
- [Padding and Look-Ahead Mask in the Transformer Decoder](/blogs/understanding-padding-and-look-ahead-mask-in-the-transformer-decoder)
- [Encoder - Decoder Attention in the Transformer](/blogs/encoder-decoder-attention-in-the-transformer)
- [Sinusoidal Positional Encoding in the Transformer](/blogs/sinusoidal-positional-encoding-in-the-transformer)
